<h1 id="top-n">Top N<a aria-hidden="true" class="anchor-heading icon-link" href="#top-n"></a></h1>
<h2 id="각-카테고리의-상위-n개-추출하기">각 카테고리의 상위 n개 추출하기<a aria-hidden="true" class="anchor-heading icon-link" href="#각-카테고리의-상위-n개-추출하기"></a></h2>
<pre class="language-sql"><code class="language-sql"><span class="token comment">-- # 각 카테고리의 상위 n개 추출하기</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span>
	<span class="token comment">-- 서브 쿼리 내부에서 순위 계산하기</span>
    <span class="token punctuation">(</span> <span class="token keyword">SELECT</span>
     	  category
     	<span class="token punctuation">,</span> product_id
     	<span class="token punctuation">,</span> score
     	  <span class="token comment">-- 카테고리별로 점수 순서로 유일한 순위를 붙임</span>
     	<span class="token punctuation">,</span> ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span>
     		<span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> score <span class="token keyword">DESC</span><span class="token punctuation">)</span>
     	  <span class="token keyword">AS</span> rank
       <span class="token keyword">FROM</span> popular_products
     <span class="token punctuation">)</span> <span class="token keyword">AS</span> popular_products_with_ranks
<span class="token comment">-- 외부 쿼리에서 순위 활용해 압축하기</span>
<span class="token keyword">WHERE</span> rank <span class="token operator">&#x3C;=</span> <span class="token number">3</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> category<span class="token punctuation">,</span> rank
<span class="token punctuation">;</span>
</code></pre>
<h2 id="각-카테고리에서-최상위-상품-추출하기">각 카테고리에서 최상위 상품 추출하기<a aria-hidden="true" class="anchor-heading icon-link" href="#각-카테고리에서-최상위-상품-추출하기"></a></h2>
<pre class="language-sql"><code class="language-sql"><span class="token comment">-- # 각 카테고리에서 최상위 상품 추출하기</span>
<span class="token comment">-- DISTINCT 구문을 사용해 중복 제거하기</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span>
	  category
      <span class="token comment">-- 카테고리별로 순위 최상위 상품 ID 추출하기</span>
    <span class="token punctuation">,</span> FIRST_VALUE<span class="token punctuation">(</span>product_id<span class="token punctuation">)</span>
      <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> score <span class="token keyword">DESC</span>
           <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token keyword">UNBOUNDED</span> <span class="token keyword">PRECEDING</span> <span class="token operator">AND</span> <span class="token keyword">UNBOUNDED</span> <span class="token keyword">FOLLOWING</span><span class="token punctuation">)</span>
      <span class="token keyword">AS</span> product_id
<span class="token keyword">FROM</span> popular_products
<span class="token punctuation">;</span>
</code></pre>