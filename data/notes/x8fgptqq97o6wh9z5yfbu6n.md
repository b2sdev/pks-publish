
쿠버네티스는 컨테이너(예: 도커)화된 애플리케이션이 실행되는 여러 머신을 하나의 리소스 풀로 취급하여 애플리케이션의 배포, 확장 및 관리를 자동화하는 오픈소스 컨테이너 오케스트레이션 프레임워크다. 서비스 디스커버리, 로드 밸런싱, 자동 복구, 볼링 업데이트 등의 기능을 제공한다.

## 주요 기능

- **리소스 관리**: 여러 머신을 CPU, 메모리, 스토리지 볼륨을 묶어 놓은 하나의 리소스 풀로 취급함 
- **스케줄링**: 컨테이너를 실행할 머신을 선택
    - 스케줄링은 기본적으로 컨테이너의 리소스 요건 및 노드별 리소스 상황에 따라 결정됨
    - 또 유사성(affinity)을 찾아내 여러 컨테이너를 같은 노드에 배치하거나, 반대로 반유사성(anti-affinity)을 발견하여 컨테이너를 다른 노드에 옮김
- **서비스 관리**: 
    - 마이크로서비스에 직접 매핑되는 서비스를 명명하고 버저닝
    - 정상 인스턴스를 항상 적정 개수만큼 가동시키고 요청 부하를 인스턴스에 고루 분산
    - 서비스를 롤링 업데이트(rolling update)[^1]하는 기능도 있어서 구 버전으로 바로 롤백할 수 있음

> 쿠버네티스는 원하는 개수의 서비스 인스턴스를 실행하라고 지시하면 서비스 인스턴스나 머신이 깨지더라도 항상 서비스 인스턴스별 개수가 원하는 만큼 실행되도록 유지합니다.

## 쿠버네티스 아키텍처

- 쿠버네티스는 머신 클러스터에서 실행되며, 클러스터는 대부분 소수의(보통 하나의) 마스터(master)와 하나 이상의 노드(node)로 구성됨
- 마스터는 클러스터를 관장, 노드는 하나 이상의 파드(pod)를 실행하는 워커
- 파드는 여러 컨테이너로 구성된 쿠버네티스의 배포 단위

### 마스터
마스터는 다음 컴포넌트를 실행
- **API 서버**: kubectl CLI에서 사용하는 서비스 배포/관리용 REST API
- **etcd**: 클러스터 데이터를 저장하는 키-값 NoSQL DB
- **스케줄러**: 파드를 실행할 노드를 선택
- **컨트롤러 관리자**: 컨트롤러를 실행
    - 컨트롤러는 클러스터가 원하는 상태가 되도록 제어함
    - 가령 복제 컨트롤러(replication controller)는 서비스 인스턴스가 적정 개수만큼 실행되도록 인스턴스를 시동/중지

### 노드
노드는 다음 컴포넌트를 실행
- **큐블릿**: 노드에서 실행된느 파드를 생성/관리
- **큐브 프록시(kube-proxy)**: 여러 파드에 부하를 분산하는 등 네트워킹을 관리
- **파드**: 애플리케이션 서비스

## 쿠버네티스 핵심 개념
쿠버네티스는 객체라는 핵심 개념만 잘 이해하면 효과적으로 활용할 수 있음

### 파드(pod)
- 쿠버네티스의 기본 배포 단위
- IP 주소, 스토리지 볼륨을 공유하는 하나 이상의 컨테이너로 구성됨
- 파드의 컨테이너와 파드가 실행하는 노드, 둘 중 하나는 언제라도 깨질 수 있기 때문에 파드는 일시적(ephemeral)임

### 디플로이먼트(deployment): 파드의 선언형 명세
- 항상 파드 인스턴스(서비스 인스턴스)를 원하는 개수만큼 실행시키느 컨트롤러
- 롤링 업데이트/롤백 기능이 탑재된 버저닝을 지원

### 서비스(service)
- 클라이언트에 안정된 정적 네트워크 위치를 제공
- 인프라에서 제공된 서비스 디스커버리 형태를 따름
- IP 주소와 이 주소로 해석되는 DNS명이 할당된 서비스는 TCP/UDP 트래픽을 하나 이상의 파드에 고루 분산
- IP 주소, DNS명은 오직 쿠버네티스 내부에서만 접근할 수 있음

### 컨피그맵(ConfigMap)
- 하나 이상의 애플리케이션 서비스에 대한 외부화 구성이 정의된 이름-값 쌍의 컬렉션
- 파드 컨테이너의 데피니션은 컨테이너 환경 변수를 정의하기 위해 컨피그맵을 참조

## References
크리스 리처드슨, 마이크로서비스 패턴, 길벗

[^1]: 파드(pod) 인스턴스를 점진적으로 새로운 것으로 업데이트하여 디플로이먼트(deployment) 업데이트가 서비스 중단 없이 이루어질 수 있게 하는 것