<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/pks-publish/favicon.ico"/><title>Dataframe</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal Knowledge Space"/><meta property="og:title" content="Dataframe"/><meta property="og:description" content="Personal Knowledge Space"/><meta property="og:url" content="https://b2sdev.github.io/pks-publish/notes/sfeu6c5r2tcv2mgr2xpo696/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="10/29/2022"/><meta property="article:modified_time" content="12/1/2022"/><link rel="canonical" href="https://b2sdev.github.io/pks-publish/notes/sfeu6c5r2tcv2mgr2xpo696/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/pks-publish/_next/static/css/3646adbe9f4978fb.css" as="style"/><link rel="stylesheet" href="/pks-publish/_next/static/css/3646adbe9f4978fb.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/pks-publish/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/pks-publish/_next/static/chunks/webpack-76e99ab115ade130.js" defer=""></script><script src="/pks-publish/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/pks-publish/_next/static/chunks/main-599200d9a16403bb.js" defer=""></script><script src="/pks-publish/_next/static/chunks/pages/_app-6eff3c921e9661a4.js" defer=""></script><script src="/pks-publish/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/pks-publish/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/pks-publish/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/pks-publish/_next/static/MBpMZiPEoVJLwa6Uvfsj2/_buildManifest.js" defer=""></script><script src="/pks-publish/_next/static/MBpMZiPEoVJLwa6Uvfsj2/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="dataframe">Dataframe<a aria-hidden="true" class="anchor-heading icon-link" href="#dataframe"></a></h1>
<h2 id="spark-sql">Spark SQL<a aria-hidden="true" class="anchor-heading icon-link" href="#spark-sql"></a></h2>
<blockquote>
<p>Spark SQL은 옵티마이저에 의해 제어되며 사용자가 제어권을 포기</p>
</blockquote>
<h2 id="dataframe-생성">Dataframe 생성<a aria-hidden="true" class="anchor-heading icon-link" href="#dataframe-생성"></a></h2>
<pre class="language-python"><code class="language-python">df <span class="token operator">=</span> spark<span class="token punctuation">.</span>createDataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">(</span><span class="token string">'01'</span><span class="token punctuation">,</span> <span class="token string">'aws'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token string">'02'</span><span class="token punctuation">,</span> <span class="token string">'azure'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token string">'03'</span><span class="token punctuation">,</span> <span class="token string">'gcp'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre class="language-python"><code class="language-python">spark<span class="token punctuation">.</span>createDataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">"summer"</span><span class="token punctuation">,</span> <span class="token number">4.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"winter"</span><span class="token punctuation">,</span> <span class="token number">7.5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"season"</span><span class="token punctuation">,</span> <span class="token string">"wind_speed_ms"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="from-python-dictionary">from Python Dictionary<a aria-hidden="true" class="anchor-heading icon-link" href="#from-python-dictionary"></a></h3>
<pre class="language-python"><code class="language-python">data <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Gildong'</span><span class="token punctuation">,</span> <span class="token string">'address'</span><span class="token punctuation">:</span> <span class="token string">'Seoul'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">]</span>
df <span class="token operator">=</span> spark<span class="token punctuation">.</span>createDataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span>data<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="데이터-읽기">데이터 읽기<a aria-hidden="true" class="anchor-heading icon-link" href="#데이터-읽기"></a></h2>
<pre class="language-python"><code class="language-python">spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"csv"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"header"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>load<span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
</code></pre>
<pre class="language-python"><code class="language-python">df <span class="token operator">=</span> spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>parquet<span class="token punctuation">(</span><span class="token string">"path/to/x.parquet"</span><span class="token punctuation">)</span>
</code></pre>
<pre class="language-python"><code class="language-python"><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span>
<span class="token operator">|</span>itemId<span class="token operator">|</span>attributes                   <span class="token operator">|</span>supplier           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span>
<span class="token operator">|</span><span class="token number">1</span>     <span class="token operator">|</span><span class="token punctuation">[</span>blue<span class="token punctuation">,</span> winter<span class="token punctuation">,</span> cozy<span class="token punctuation">]</span>         <span class="token operator">|</span>Sports Company Inc<span class="token punctuation">.</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token number">2</span>     <span class="token operator">|</span><span class="token punctuation">[</span>red<span class="token punctuation">,</span> summer<span class="token punctuation">,</span> fresh<span class="token punctuation">,</span> cooling<span class="token punctuation">]</span><span class="token operator">|</span>YetiX              <span class="token operator">|</span>
<span class="token operator">|</span><span class="token number">3</span>     <span class="token operator">|</span><span class="token punctuation">[</span>green<span class="token punctuation">,</span> summer<span class="token punctuation">,</span> travel<span class="token punctuation">]</span>      <span class="token operator">|</span>Sports Company Inc<span class="token punctuation">.</span><span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">+</span>

itemsDfSchema <span class="token operator">=</span> StructType<span class="token punctuation">(</span><span class="token punctuation">[</span>
  StructField<span class="token punctuation">(</span><span class="token string">"itemId"</span><span class="token punctuation">,</span> IntegerType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  StructField<span class="token punctuation">(</span><span class="token string">"attributes"</span><span class="token punctuation">,</span> ArrayType<span class="token punctuation">(</span>StringType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  StructField<span class="token punctuation">(</span><span class="token string">"supplier"</span><span class="token punctuation">,</span> StringType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
itemsDf <span class="token operator">=</span> spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>schema<span class="token punctuation">(</span>itemsDfSchema<span class="token punctuation">)</span><span class="token punctuation">.</span>parquet<span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
</code></pre>
<pre class="language-python"><code class="language-python"><span class="token comment"># return the number of columns in the CSV file stored at location filePath. From the CSV file, only lines should be read that do not start with a # character</span>
<span class="token builtin">len</span><span class="token punctuation">(</span>spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>csv<span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> comment<span class="token operator">=</span><span class="token string">'#'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>columns<span class="token punctuation">)</span>
<span class="token comment"># comment – sets a single character used for skipping lines beginning with this character. By default (None), it is disabled.</span>
</code></pre>
<ul>
<li><a href="https://www.marks4sure.com/Databricks-Certified-Associate-Developer-for-Apache-Spark-3-0-exam.html">https://www.marks4sure.com/Databricks-Certified-Associate-Developer-for-Apache-Spark-3-0-exam.html</a></li>
</ul>
<h2 id="데이터-저장">데이터 저장<a aria-hidden="true" class="anchor-heading icon-link" href="#데이터-저장"></a></h2>
<pre class="language-python"><code class="language-python"><span class="token comment"># 하나의 파일로 저장</span>
df<span class="token punctuation">.</span>coalease<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mode<span class="token punctuation">(</span><span class="token string">'overwrite'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">'header'</span><span class="token punctuation">,</span> <span class="token string">'true'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
</code></pre>
<pre class="language-python"><code class="language-python"><span class="token comment"># division으로 partitioning 후 저장</span>
df<span class="token punctuation">.</span>write<span class="token punctuation">.</span>partitionBy<span class="token punctuation">(</span><span class="token string">"division"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parquet<span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
</code></pre>
<pre class="language-python"><code class="language-python"><span class="token comment"># 데이터 추가를 위해 저장 모드 지정</span>
<span class="token keyword">def</span> <span class="token function">writeAppend</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">:</span> DataFrame<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token builtin">input</span><span class="token punctuation">.</span>write<span class="token punctuation">.</span>mode<span class="token punctuation">(</span><span class="token string">"append"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">"output/"</span><span class="token punctuation">)</span>
</code></pre>
<pre class="language-python"><code class="language-python"><span class="token comment"># 우편번호로 파티션해서 저장</span>
<span class="token keyword">def</span> <span class="token function">writeOutByZip</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">:</span> DataFrame<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token builtin">input</span><span class="token punctuation">.</span>write<span class="token punctuation">.</span>partitionBy<span class="token punctuation">(</span><span class="token string">"zipcode"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"json"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">"output/"</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="컬럼-조작">컬럼 조작<a aria-hidden="true" class="anchor-heading icon-link" href="#컬럼-조작"></a></h2>
<div class="table-responsive">

















































<table><thead><tr><th>What</th><th>How</th><th></th></tr></thead><tbody><tr><td>선택</td><td>df.select('id', 'body')</td><td></td></tr><tr><td>제거</td><td>df.drop('body') <br> df.drop('productId', 'value')</td><td></td></tr><tr><td>필터링</td><td>df.filter(col("col_1") &#x26;| col("col_2)).limit(10)</td><td></td></tr><tr><td>추가</td><td>df.withColumn('col', lit(1))</td><td></td></tr><tr><td>이름 변경</td><td>df.withColumnRenamed('ownerUserId', 'owner')</td><td></td></tr><tr><td>정렬</td><td>df.orderBy() <br> df.sort()</td><td></td></tr><tr><td>조건</td><td>when((f.col('a').cast(IntegerType()) > 0), 1).otherwise(0)</td><td></td></tr><tr><td>이름 변경</td><td>col_name = [...] <br> df.toDF(*col_name)</td><td></td></tr></tbody></table></div>
<h2 id="데이터-처리">데이터 처리<a aria-hidden="true" class="anchor-heading icon-link" href="#데이터-처리"></a></h2>
<div class="table-responsive">




























<table><thead><tr><th>What</th><th>How</th></tr></thead><tbody><tr><td>필터</td><td>df.filter</td></tr><tr><td>정렬</td><td>df.orderBy()</td></tr><tr><td>집약</td><td>df.agg(avg(col("kcal")) as "") <br> df.groupBy(...).agg(max(~).alias(~))</td></tr><tr><td>결합</td><td>df.join(df2, on=[...], how="inner/left") <br> df.join(df2, df['id'] == postId, 'outer')</td></tr><tr><td>집계</td><td>df.groupBy().agg… <br> df.distinct()</td></tr></tbody></table></div>
<h2 id="sql-활용">SQL 활용<a aria-hidden="true" class="anchor-heading icon-link" href="#sql-활용"></a></h2>
<pre class="language-python"><code class="language-python">df<span class="token punctuation">.</span>registerTempTable<span class="token punctuation">(</span><span class="token string">"dessert_table"</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>createOrReplaceTempView<span class="token punctuation">(</span><span class="token string">"dessert_table"</span><span class="token punctuation">)</span>
numOver300KcalDf <span class="token operator">=</span> spark<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token string">"SELECT cound(*) AS num_of_over_30Kcal FROM dessert_table WHERE kcal >= 260"</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="take">Take<a aria-hidden="true" class="anchor-heading icon-link" href="#take"></a></h2>
<pre class="language-python"><code class="language-python">transactionDf<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"storeId"</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">.</span>take<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="distinct">Distinct<a aria-hidden="true" class="anchor-heading icon-link" href="#distinct"></a></h2>
<p>특정 컬럼의 unique values</p>
<pre class="language-python"><code class="language-python">transactionDf<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">"storeId"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="partition-변경">Partition 변경<a aria-hidden="true" class="anchor-heading icon-link" href="#partition-변경"></a></h2>
<ul>
<li>
<p><code>partitionBy</code>: 셔플링을 통해 새로운 RDD를 생성</p>
</li>
<li>
<p><code>coalesce</code>: 파티션 개수를 줄이거나(shuffle=false) 늘림(shuffle=true)</p>
<ul>
<li>셔플링을 피하기 위해 같은 worker 안에서 partition들을 병합</li>
<li>partition의 개수가 줄어들면서 (~병합되면서) partition 크기의 편향이 발생할 수 있음</li>
</ul>
<p><img src="https://images.squarespace-cdn.com/content/v1/5bce4071ab1a620db382773e/d14468bd-009b-4f2f-9d84-7c752862b1b8/Before+Repartition.png?format=1000w"></p>
</li>
<li>
<p><code>repartition</code>: coalesce(n, shuffle=true)와 동일
<img src="https://images.squarespace-cdn.com/content/v1/5bce4071ab1a620db382773e/4f68dd4e-fe65-4106-96c4-1060e9ab8569/After+Repartition.png?format=1000w"></p>
</li>
</ul>
<h2 id="컬럼-split">컬럼 split<a aria-hidden="true" class="anchor-heading icon-link" href="#컬럼-split"></a></h2>
<pre class="language-python"><code class="language-python"><span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>functions <span class="token keyword">import</span> split

<span class="token punctuation">(</span>df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span>
    <span class="token string">"firstName"</span><span class="token punctuation">,</span> split<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getItem<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span>
    <span class="token string">"lastName"</span><span class="token punctuation">,</span> split<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getItem<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre>
<h2 id="컬럼-이름-변경">컬럼 이름 변경<a aria-hidden="true" class="anchor-heading icon-link" href="#컬럼-이름-변경"></a></h2>
<pre><code>df.withColumnRenamed(`old column name`, `new colun name`)
</code></pre>
<h2 id="결측-값-다루기">결측 값 다루기<a aria-hidden="true" class="anchor-heading icon-link" href="#결측-값-다루기"></a></h2>
<pre class="language-python"><code class="language-python">df<span class="token punctuation">.</span>na<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># df.na.drop("any")</span>
df<span class="token punctuation">.</span>na<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">"all"</span><span class="token punctuation">)</span>
<span class="token comment"># df.na.drop(col("col_name"))</span>
<span class="token comment"># df.na.fill(map(col("count"), 0)))</span>

df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>thresh<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment"># ㅁhave missing data in a least 3 columns</span>
</code></pre>
<h2 id="첫번째-줄">첫번째 줄<a aria-hidden="true" class="anchor-heading icon-link" href="#첫번째-줄"></a></h2>
<pre class="language-cmd"><code class="language-cmd">>>> df.first()
Row(age=2, name='Alice')
>>> df.first().name
Alice
</code></pre>
<h2 id="조건에-따른-boolean">조건에 따른 boolean<a aria-hidden="true" class="anchor-heading icon-link" href="#조건에-따른-boolean"></a></h2>
<pre class="language-python"><code class="language-python">transactionDf<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"storeId"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>between<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&#x26;</span> <span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"productId"</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li><a href="https://www.marks4sure.com/databricks-certified-associate-developer-for-apache-spark-3-0-databricks-certified-associate-developer-for-apache-spark-3-0-exam-questions.html">https://www.marks4sure.com/databricks-certified-associate-developer-for-apache-spark-3-0-databricks-certified-associate-developer-for-apache-spark-3-0-exam-questions.html</a></li>
</ul>
<h2 id="시용자-정의-함수">시용자 정의 함수<a aria-hidden="true" class="anchor-heading icon-link" href="#시용자-정의-함수"></a></h2>
<pre class="language-python"><code class="language-python">spark<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">"ACCESS_PERFORMANCE"</span><span class="token punctuation">,</span> assessPerformance<span class="token punctuation">)</span>
spark<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token string">"SELECT customerSatisfactgion, ASSESS_PERFORMANCE(customerSatisfaction) AS result FROM stores"</span><span class="token punctuation">)</span>
</code></pre>
<pre class="language-python"><code class="language-python">assessPerformanceUDF <span class="token operator">=</span> udf<span class="token punctuation">(</span>assessPerformance<span class="token punctuation">,</span> IntegerType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
storedDF<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span> assessPerformanceUDF<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"customerSatisfaction"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="unix-epoch-format에서-월month-추출">UNIX epoch format에서 월(month) 추출<a aria-hidden="true" class="anchor-heading icon-link" href="#unix-epoch-format에서-월month-추출"></a></h2>
<pre class="language-python"><code class="language-python">storedDF<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">"openTimestamp"</span><span class="token punctuation">,</span> col<span class="token punctuation">(</span><span class="token string">"openDate"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cast<span class="token punctuation">(</span><span class="token string">"Timestamp"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> \
        <span class="token punctuation">.</span>withColun<span class="token punctuation">(</span><span class="token string">"month"</span><span class="token punctuation">,</span> month<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"openTimestamp"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="join">Join<a aria-hidden="true" class="anchor-heading icon-link" href="#join"></a></h2>
<blockquote>
<p>스파크의 기본 join 구현은 <code>shuffled hash join</code></p>
<ul>
<li>양쪽 RDD에서 같은 해시값의 키들이 같은 파티션에 모이도록 데이터를 이동(shuffle)</li>
</ul>
</blockquote>
<p><code>df1.join(df2, joinExpression, joinType)</code></p>
<pre class="language-python"><code class="language-python"><span class="token comment"># inner join</span>
df<span class="token punctuation">.</span>join<span class="token punctuation">(</span>newdf<span class="token punctuation">,</span> df<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">==</span> newdf<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> <span class="token string">"inner"</span><span class="token punctuation">)</span>
df1<span class="token punctuation">.</span>join<span class="token punctuation">(</span>df2<span class="token punctuation">,</span> df1<span class="token punctuation">.</span>col<span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token operator">==</span>df2<span class="token punctuation">.</span>col<span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"inner"</span><span class="token punctuation">)</span>

<span class="token comment"># outer join</span>
storesDF<span class="token punctuation">.</span>join<span class="token punctuation">(</span>employeesDF<span class="token punctuation">,</span> <span class="token string">"storeID"</span><span class="token punctuation">,</span> <span class="token string">"outer"</span><span class="token punctuation">)</span>

<span class="token comment"># multiple keys</span>
storesDF<span class="token punctuation">.</span>join<span class="token punctuation">(</span>employeesDF<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"storeId"</span><span class="token punctuation">,</span> <span class="token string">"employeeId"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<blockquote>
<p>Join은 일상적으로 쓰이는 스파크의 연산 중 가장 비싼 축에 속한다. Join을 수행하기 전에 필터링을 적용하여 데이터의 크기를 최대한 줄여 놓으면 더 빠르게 join할 수 있다.</p>
</blockquote>
<h2 id="broadcast-join">Broadcast join<a aria-hidden="true" class="anchor-heading icon-link" href="#broadcast-join"></a></h2>
<ul>
<li>Join하려는 두 테이블 중 하나가 다른 쪽보다 작은 경우 작은 쪽의 RDD를 큰 쪽의 worker node에 복사 --> join 시 발생하는 shuffle이 일어나지 않도록 하여 join 속도를 올림
<pre class="language-python"><code class="language-python">transactionDf<span class="token punctuation">.</span>join<span class="token punctuation">(</span>broadcast<span class="token punctuation">(</span>itemsDf<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"transactionId"</span><span class="token punctuation">,</span> <span class="token string">"left_semi"</span><span class="token punctuation">)</span>
</code></pre>
</li>
<li><a href="/pks-publish/notes/t9h5i24qpl5wpfziw749zvv">Spark Config</a>의 <code>spark.sql.autoBroadcastJoinThreshold</code> 설정으로 테이블을 자동으로 브로드캐스팅할수도 있음</li>
</ul>
<h2 id="explode">Explode<a aria-hidden="true" class="anchor-heading icon-link" href="#explode"></a></h2>
<pre><code>+------+-----------------------------+-------------------+
|itemId|attributes                   |supplier           |
+------+-----------------------------+-------------------+
|1     |[blue, winter, cozy]         |Sports Company Inc.|
|2     |[red, summer, fresh, cooling]|YetiX              |
|3     |[green, summer, travel]      |Sports Company Inc.|
+------+-----------------------------+-------------------+
</code></pre>
<pre class="language-python"><code class="language-python">articlesDf<span class="token punctuation">.</span>select<span class="token punctuation">(</span>explode<span class="token punctuation">(</span>col<span class="token punctuation">(</span>'attributes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> \
          <span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span><span class="token string">'col'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span> \
          <span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">,</span> ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> \
          <span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'col'</span><span class="token punctuation">)</span>
</code></pre>
<pre><code>+-------+
| col   |
+-------+
| summer|
| winter|
| blue  |
| cozy  |
| travel|
| fresh |
| red   |
| cooling|
| green |
+-------+
</code></pre>
<h2 id="그룹에서-순위">그룹에서 순위<a aria-hidden="true" class="anchor-heading icon-link" href="#그룹에서-순위"></a></h2>
<pre class="language-scala"><code class="language-scala"><span class="token comment">// 데이터</span>
<span class="token keyword">val</span> peopleDF <span class="token operator">=</span> Seq<span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token string">"Ali"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Seq<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token string">"Barbara"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Seq<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token string">"Cesar"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Seq<span class="token punctuation">(</span><span class="token number">350</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token string">"Dongmei"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Seq<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token string">"Eli"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> Seq<span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token string">"Florita"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> Seq<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token string">"Gatimu"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> Seq<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span>toDF<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"department"</span><span class="token punctuation">,</span> <span class="token string">"score"</span><span class="token punctuation">)</span>

<span class="token comment">// 기대 결과</span>
<span class="token operator">|</span>department<span class="token operator">|</span> name <span class="token operator">|</span>highest<span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">0</span><span class="token operator">|</span> Ali<span class="token operator">|</span> <span class="token number">100</span><span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">1</span><span class="token operator">|</span>Dongmei<span class="token operator">|</span> <span class="token number">400</span><span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span><span class="token operator">|</span>Florita<span class="token operator">|</span> <span class="token number">500</span><span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span><span class="token operator">|</span> Gatimu<span class="token operator">|</span> <span class="token number">300</span><span class="token operator">|</span>

<span class="token comment">// 솔루션</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>expressions<span class="token punctuation">.</span></span>Window
<span class="token keyword">val</span> windowSpec <span class="token operator">=</span> Window<span class="token punctuation">.</span>partitionBy<span class="token punctuation">(</span><span class="token string">"department"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>orderBy<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"score"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>desc<span class="token punctuation">)</span>

peopleDF
<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">"score"</span><span class="token punctuation">,</span> explode<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"score"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span>select<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"department"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>col<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>dense_rank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>over<span class="token punctuation">(</span>windowSpec<span class="token punctuation">)</span><span class="token punctuation">.</span>alias<span class="token punctuation">(</span><span class="token string">"rank"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> max<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"score"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>over<span class="token punctuation">(</span>windowSpec<span class="token punctuation">)</span><span class="token punctuation">.</span>alias<span class="token punctuation">(</span><span class="token string">"highest"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span>where<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">"rank"</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">"rank"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span>orderBy<span class="token punctuation">(</span><span class="token string">"department"</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#spark-sql" title="Spark SQL">Spark SQL</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#dataframe-생성" title="Dataframe 생성">Dataframe 생성</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#from-python-dictionary" title="from Python Dictionary">from Python Dictionary</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#데이터-읽기" title="데이터 읽기">데이터 읽기</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#데이터-저장" title="데이터 저장">데이터 저장</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#컬럼-조작" title="컬럼 조작">컬럼 조작</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#데이터-처리" title="데이터 처리">데이터 처리</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#sql-활용" title="SQL 활용">SQL 활용</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#take" title="Take">Take</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#distinct" title="Distinct">Distinct</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#partition-변경" title="Partition 변경">Partition 변경</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#컬럼-split" title="컬럼 split">컬럼 split</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#컬럼-이름-변경" title="컬럼 이름 변경">컬럼 이름 변경</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#결측-값-다루기" title="결측 값 다루기">결측 값 다루기</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#첫번째-줄" title="첫번째 줄">첫번째 줄</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#조건에-따른-boolean" title="조건에 따른 boolean">조건에 따른 boolean</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#시용자-정의-함수" title="시용자 정의 함수">시용자 정의 함수</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#unix-epoch-format에서-월month-추출" title="UNIX epoch format에서 월(month) 추출">UNIX epoch format에서 월(month) 추출</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#join" title="Join">Join</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#broadcast-join" title="Broadcast join">Broadcast join</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#explode" title="Explode">Explode</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#그룹에서-순위" title="그룹에서 순위">그룹에서 순위</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"sfeu6c5r2tcv2mgr2xpo696","title":"Dataframe","desc":"","updated":1669884802443,"created":1667042550960,"custom":{},"fname":"dev.data+ai.spark.dataframe","type":"note","vault":{"fsPath":".","selfContained":true,"name":"Dendron"},"contentHash":"d6718978a4bf931b2dc399ac07492c69","links":[{"type":"wiki","from":{"fname":"dev.data+ai.spark.dataframe","id":"sfeu6c5r2tcv2mgr2xpo696","vaultName":"Dendron"},"value":"dev.data+ai.spark.config","position":{"start":{"line":233,"column":3,"offset":5952},"end":{"line":233,"column":31,"offset":5980},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"dev.data+ai.spark.config"}}],"anchors":{"spark-sql":{"type":"header","text":"Spark SQL","value":"spark-sql","line":8,"column":0,"depth":2},"dataframe-생성":{"type":"header","text":"Dataframe 생성","value":"dataframe-생성","line":12,"column":0,"depth":2},"from-python-dictionary":{"type":"header","text":"from Python Dictionary","value":"from-python-dictionary","line":27,"column":0,"depth":3},"데이터-읽기":{"type":"header","text":"데이터 읽기","value":"데이터-읽기","line":37,"column":0,"depth":2},"데이터-저장":{"type":"header","text":"데이터 저장","value":"데이터-저장","line":71,"column":0,"depth":2},"컬럼-조작":{"type":"header","text":"컬럼 조작","value":"컬럼-조작","line":94,"column":0,"depth":2},"데이터-처리":{"type":"header","text":"데이터 처리","value":"데이터-처리","line":106,"column":0,"depth":2},"sql-활용":{"type":"header","text":"SQL 활용","value":"sql-활용","line":116,"column":0,"depth":2},"take":{"type":"header","text":"Take","value":"take","line":123,"column":0,"depth":2},"distinct":{"type":"header","text":"Distinct","value":"distinct","line":129,"column":0,"depth":2},"partition-변경":{"type":"header","text":"Partition 변경","value":"partition-변경","line":136,"column":0,"depth":2},"컬럼-split":{"type":"header","text":"컬럼 split","value":"컬럼-split","line":147,"column":0,"depth":2},"컬럼-이름-변경":{"type":"header","text":"컬럼 이름 변경","value":"컬럼-이름-변경","line":160,"column":0,"depth":2},"결측-값-다루기":{"type":"header","text":"결측 값 다루기","value":"결측-값-다루기","line":166,"column":0,"depth":2},"첫번째-줄":{"type":"header","text":"첫번째 줄","value":"첫번째-줄","line":177,"column":0,"depth":2},"조건에-따른-boolean":{"type":"header","text":"조건에 따른 boolean","value":"조건에-따른-boolean","line":186,"column":0,"depth":2},"시용자-정의-함수":{"type":"header","text":"시용자 정의 함수","value":"시용자-정의-함수","line":193,"column":0,"depth":2},"unix-epoch-format에서-월month-추출":{"type":"header","text":"UNIX epoch format에서 월(month) 추출","value":"unix-epoch-format에서-월month-추출","line":205,"column":0,"depth":2},"join":{"type":"header","text":"Join","value":"join","line":212,"column":0,"depth":2},"broadcast-join":{"type":"header","text":"Broadcast join","value":"broadcast-join","line":233,"column":0,"depth":2},"explode":{"type":"header","text":"Explode","value":"explode","line":241,"column":0,"depth":2},"그룹에서-순위":{"type":"header","text":"그룹에서 순위","value":"그룹에서-순위","line":276,"column":0,"depth":2}},"children":[],"parent":"mvmjei3kla5158ugqpwf79z","data":{}},"body":"\u003ch1 id=\"dataframe\"\u003eDataframe\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#dataframe\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003ch2 id=\"spark-sql\"\u003eSpark SQL\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#spark-sql\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eSpark SQL은 옵티마이저에 의해 제어되며 사용자가 제어권을 포기\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"dataframe-생성\"\u003eDataframe 생성\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#dataframe-생성\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003edf \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e spark\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreateDataFrame\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'01'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'aws'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'02'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'azure'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'03'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'gcp'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\ndf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003espark\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreateDataFrame\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"summer\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e4.5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"winter\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e7.5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"season\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"wind_speed_ms\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"from-python-dictionary\"\u003efrom Python Dictionary\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#from-python-dictionary\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003edata \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e10\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'name'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Gildong'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'address'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Seoul'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\ndf \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e spark\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreateDataFrame\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"데이터-읽기\"\u003e데이터 읽기\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#데이터-읽기\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003espark\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eread\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eformat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"csv\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoption\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"header\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eload\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efilePath\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003edf \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e spark\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eread\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eparquet\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"path/to/x.parquet\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e|\u003c/span\u003eitemId\u003cspan class=\"token operator\"\u003e|\u003c/span\u003eattributes                   \u003cspan class=\"token operator\"\u003e|\u003c/span\u003esupplier           \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e     \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eblue\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e winter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cozy\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e         \u003cspan class=\"token operator\"\u003e|\u003c/span\u003eSports Company Inc\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e     \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ered\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e summer\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fresh\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cooling\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e|\u003c/span\u003eYetiX              \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e     \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003egreen\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e summer\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e travel\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e      \u003cspan class=\"token operator\"\u003e|\u003c/span\u003eSports Company Inc\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\n\nitemsDfSchema \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e StructType\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n  StructField\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"itemId\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e IntegerType\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  StructField\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"attributes\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e ArrayType\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eStringType\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  StructField\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"supplier\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e StringType\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nitemsDf \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e spark\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eread\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eschema\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eitemsDfSchema\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eparquet\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efilePath\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token comment\"\u003e# return the number of columns in the CSV file stored at location filePath. From the CSV file, only lines should be read that do not start with a # character\u003c/span\u003e\n\u003cspan class=\"token builtin\"\u003elen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003espark\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eread\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecsv\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efilePath\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e comment\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'#'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecolumns\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# comment – sets a single character used for skipping lines beginning with this character. By default (None), it is disabled.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.marks4sure.com/Databricks-Certified-Associate-Developer-for-Apache-Spark-3-0-exam.html\"\u003ehttps://www.marks4sure.com/Databricks-Certified-Associate-Developer-for-Apache-Spark-3-0-exam.html\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"데이터-저장\"\u003e데이터 저장\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#데이터-저장\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token comment\"\u003e# 하나의 파일로 저장\u003c/span\u003e\ndf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecoalease\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewrite\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eformat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emode\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'overwrite'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoption\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'header'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'true'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esave\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epath\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token comment\"\u003e# division으로 partitioning 후 저장\u003c/span\u003e\ndf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewrite\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epartitionBy\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"division\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eparquet\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efilePath\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token comment\"\u003e# 데이터 추가를 위해 저장 모드 지정\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ewriteAppend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003einput\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e DataFrame\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"token builtin\"\u003einput\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewrite\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emode\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"append\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esave\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"output/\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token comment\"\u003e# 우편번호로 파티션해서 저장\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ewriteOutByZip\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003einput\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e DataFrame\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"token builtin\"\u003einput\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewrite\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epartitionBy\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"zipcode\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eformat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"json\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esave\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"output/\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"컬럼-조작\"\u003e컬럼 조작\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#컬럼-조작\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cdiv class=\"table-responsive\"\u003e\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003ctable\u003e\u003cthead\u003e\u003ctr\u003e\u003cth\u003eWhat\u003c/th\u003e\u003cth\u003eHow\u003c/th\u003e\u003cth\u003e\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd\u003e선택\u003c/td\u003e\u003ctd\u003edf.select('id', 'body')\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e제거\u003c/td\u003e\u003ctd\u003edf.drop('body') \u003cbr\u003e df.drop('productId', 'value')\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e필터링\u003c/td\u003e\u003ctd\u003edf.filter(col(\"col_1\") \u0026#x26;| col(\"col_2)).limit(10)\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e추가\u003c/td\u003e\u003ctd\u003edf.withColumn('col', lit(1))\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e이름 변경\u003c/td\u003e\u003ctd\u003edf.withColumnRenamed('ownerUserId', 'owner')\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e정렬\u003c/td\u003e\u003ctd\u003edf.orderBy() \u003cbr\u003e df.sort()\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e조건\u003c/td\u003e\u003ctd\u003ewhen((f.col('a').cast(IntegerType()) \u003e 0), 1).otherwise(0)\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e이름 변경\u003c/td\u003e\u003ctd\u003ecol_name = [...] \u003cbr\u003e df.toDF(*col_name)\u003c/td\u003e\u003ctd\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/div\u003e\n\u003ch2 id=\"데이터-처리\"\u003e데이터 처리\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#데이터-처리\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cdiv class=\"table-responsive\"\u003e\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003ctable\u003e\u003cthead\u003e\u003ctr\u003e\u003cth\u003eWhat\u003c/th\u003e\u003cth\u003eHow\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd\u003e필터\u003c/td\u003e\u003ctd\u003edf.filter\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e정렬\u003c/td\u003e\u003ctd\u003edf.orderBy()\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e집약\u003c/td\u003e\u003ctd\u003edf.agg(avg(col(\"kcal\")) as \"\") \u003cbr\u003e df.groupBy(...).agg(max(~).alias(~))\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e결합\u003c/td\u003e\u003ctd\u003edf.join(df2, on=[...], how=\"inner/left\") \u003cbr\u003e df.join(df2, df['id'] == postId, 'outer')\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd\u003e집계\u003c/td\u003e\u003ctd\u003edf.groupBy().agg… \u003cbr\u003e df.distinct()\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003c/div\u003e\n\u003ch2 id=\"sql-활용\"\u003eSQL 활용\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#sql-활용\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003edf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eregisterTempTable\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"dessert_table\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\ndf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreateOrReplaceTempView\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"dessert_table\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nnumOver300KcalDf \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e spark\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esql\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"SELECT cound(*) AS num_of_over_30Kcal FROM dessert_table WHERE kcal \u003e= 260\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"take\"\u003eTake\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#take\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003etransactionDf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token builtin\"\u003efilter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecol\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"storeId\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e==\u003c/span\u003e\u003cspan class=\"token number\"\u003e25\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etake\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"distinct\"\u003eDistinct\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#distinct\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e특정 컬럼의 unique values\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003etransactionDf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eselect\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"storeId\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edistinct\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"partition-변경\"\u003ePartition 변경\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#partition-변경\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003epartitionBy\u003c/code\u003e: 셔플링을 통해 새로운 RDD를 생성\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003ecoalesce\u003c/code\u003e: 파티션 개수를 줄이거나(shuffle=false) 늘림(shuffle=true)\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e셔플링을 피하기 위해 같은 worker 안에서 partition들을 병합\u003c/li\u003e\n\u003cli\u003epartition의 개수가 줄어들면서 (~병합되면서) partition 크기의 편향이 발생할 수 있음\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://images.squarespace-cdn.com/content/v1/5bce4071ab1a620db382773e/d14468bd-009b-4f2f-9d84-7c752862b1b8/Before+Repartition.png?format=1000w\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003erepartition\u003c/code\u003e: coalesce(n, shuffle=true)와 동일\n\u003cimg src=\"https://images.squarespace-cdn.com/content/v1/5bce4071ab1a620db382773e/4f68dd4e-fe65-4106-96c4-1060e9ab8569/After+Repartition.png?format=1000w\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"컬럼-split\"\u003e컬럼 split\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#컬럼-split\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e pyspark\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esql\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efunctions \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e split\n\n\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewithColumn\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"firstName\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e split\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edf\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\" \"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003egetItem\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewithColumn\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"lastName\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e split\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edf\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\" \"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003egetItem\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"컬럼-이름-변경\"\u003e컬럼 이름 변경\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#컬럼-이름-변경\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003edf.withColumnRenamed(`old column name`, `new colun name`)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"결측-값-다루기\"\u003e결측 값 다루기\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#결측-값-다루기\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003edf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ena\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edrop\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e# df.na.drop(\"any\")\u003c/span\u003e\ndf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ena\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edrop\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"all\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# df.na.drop(col(\"col_name\"))\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# df.na.fill(map(col(\"count\"), 0)))\u003c/span\u003e\n\ndf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edropna\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ethresh\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e4\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e# ㅁhave missing data in a least 3 columns\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"첫번째-줄\"\u003e첫번째 줄\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#첫번째-줄\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre class=\"language-cmd\"\u003e\u003ccode class=\"language-cmd\"\u003e\u003e\u003e\u003e df.first()\nRow(age=2, name='Alice')\n\u003e\u003e\u003e df.first().name\nAlice\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"조건에-따른-boolean\"\u003e조건에 따른 boolean\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#조건에-따른-boolean\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003etransactionDf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eselect\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecol\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"storeId\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebetween\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e20\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e30\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecol\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"productId\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e==\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.marks4sure.com/databricks-certified-associate-developer-for-apache-spark-3-0-databricks-certified-associate-developer-for-apache-spark-3-0-exam-questions.html\"\u003ehttps://www.marks4sure.com/databricks-certified-associate-developer-for-apache-spark-3-0-databricks-certified-associate-developer-for-apache-spark-3-0-exam-questions.html\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"시용자-정의-함수\"\u003e시용자 정의 함수\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#시용자-정의-함수\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003espark\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eudf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eregister\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"ACCESS_PERFORMANCE\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e assessPerformance\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nspark\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esql\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"SELECT customerSatisfactgion, ASSESS_PERFORMANCE(customerSatisfaction) AS result FROM stores\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003eassessPerformanceUDF \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e udf\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eassessPerformance\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e IntegerType\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nstoredDF\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewithColumn\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"result\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e assessPerformanceUDF\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecol\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"customerSatisfaction\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"unix-epoch-format에서-월month-추출\"\u003eUNIX epoch format에서 월(month) 추출\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#unix-epoch-format에서-월month-추출\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003estoredDF\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewithColumn\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"openTimestamp\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e col\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"openDate\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecast\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Timestamp\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \\\n        \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewithColun\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"month\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e month\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecol\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"openTimestamp\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"join\"\u003eJoin\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#join\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e스파크의 기본 join 구현은 \u003ccode\u003eshuffled hash join\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e양쪽 RDD에서 같은 해시값의 키들이 같은 파티션에 모이도록 데이터를 이동(shuffle)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ccode\u003edf1.join(df2, joinExpression, joinType)\u003c/code\u003e\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token comment\"\u003e# inner join\u003c/span\u003e\ndf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejoin\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enewdf\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e df\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eid\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e newdf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"inner\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\ndf1\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejoin\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edf2\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e df1\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecol\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e==\u003c/span\u003edf2\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecol\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"inner\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# outer join\u003c/span\u003e\nstoresDF\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejoin\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eemployeesDF\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"storeID\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"outer\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# multiple keys\u003c/span\u003e\nstoresDF\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejoin\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eemployeesDF\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"storeId\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"employeeId\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003eJoin은 일상적으로 쓰이는 스파크의 연산 중 가장 비싼 축에 속한다. Join을 수행하기 전에 필터링을 적용하여 데이터의 크기를 최대한 줄여 놓으면 더 빠르게 join할 수 있다.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"broadcast-join\"\u003eBroadcast join\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#broadcast-join\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eJoin하려는 두 테이블 중 하나가 다른 쪽보다 작은 경우 작은 쪽의 RDD를 큰 쪽의 worker node에 복사 --\u003e join 시 발생하는 shuffle이 일어나지 않도록 하여 join 속도를 올림\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003etransactionDf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejoin\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebroadcast\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eitemsDf\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"transactionId\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"left_semi\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"/pks-publish/notes/t9h5i24qpl5wpfziw749zvv\"\u003eSpark Config\u003c/a\u003e의 \u003ccode\u003espark.sql.autoBroadcastJoinThreshold\u003c/code\u003e 설정으로 테이블을 자동으로 브로드캐스팅할수도 있음\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"explode\"\u003eExplode\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#explode\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003e+------+-----------------------------+-------------------+\n|itemId|attributes                   |supplier           |\n+------+-----------------------------+-------------------+\n|1     |[blue, winter, cozy]         |Sports Company Inc.|\n|2     |[red, summer, fresh, cooling]|YetiX              |\n|3     |[green, summer, travel]      |Sports Company Inc.|\n+------+-----------------------------+-------------------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003earticlesDf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eselect\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eexplode\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecol\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e'attributes\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \\\n          \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003egroupBy\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'col'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecount\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \\\n          \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esort\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'count'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e ascending\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token boolean\"\u003eFalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \\\n          \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eselect\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'col'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode\u003e+-------+\n| col   |\n+-------+\n| summer|\n| winter|\n| blue  |\n| cozy  |\n| travel|\n| fresh |\n| red   |\n| cooling|\n| green |\n+-------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"그룹에서-순위\"\u003e그룹에서 순위\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#그룹에서-순위\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre class=\"language-scala\"\u003e\u003ccode class=\"language-scala\"\u003e\u003cspan class=\"token comment\"\u003e// 데이터\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eval\u003c/span\u003e peopleDF \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Seq\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Ali\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Seq\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e100\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Barbara\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Seq\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e300\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e250\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e100\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Cesar\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Seq\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e350\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e100\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Dongmei\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Seq\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e400\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e100\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Eli\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Seq\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e250\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Florita\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Seq\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e500\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e300\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e100\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Gatimu\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Seq\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e300\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e100\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etoDF\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"department\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"score\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// 기대 결과\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e|\u003c/span\u003edepartment\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e name \u003cspan class=\"token operator\"\u003e|\u003c/span\u003ehighest\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Ali\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token number\"\u003e100\u003c/span\u003e\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token operator\"\u003e|\u003c/span\u003eDongmei\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token number\"\u003e400\u003c/span\u003e\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token operator\"\u003e|\u003c/span\u003eFlorita\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token number\"\u003e500\u003c/span\u003e\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Gatimu\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token number\"\u003e300\u003c/span\u003e\u003cspan class=\"token operator\"\u003e|\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// 솔루션\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token namespace\"\u003eorg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eapache\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003espark\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esql\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eexpressions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003eWindow\n\u003cspan class=\"token keyword\"\u003eval\u003c/span\u003e windowSpec \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Window\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epartitionBy\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"department\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eorderBy\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecol\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"score\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edesc\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\npeopleDF\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewithColumn\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"score\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e explode\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecol\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"score\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eselect\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecol\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"department\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ecol\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003edense_rank\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eover\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ewindowSpec\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ealias\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"rank\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e max\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecol\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"score\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eover\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ewindowSpec\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ealias\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"highest\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewhere\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecol\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"rank\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edrop\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"rank\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eorderBy\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"department\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e","noteIndex":{"id":"rfaecb1r4pxpahsrighqpfi","title":"Dev","desc":"","updated":1666489926104,"created":1666489926104,"custom":{"nav_order":0,"permalink":"/"},"fname":"dev","type":"note","vault":{"fsPath":".","selfContained":true,"name":"Dendron"},"contentHash":"5f3d9b993bc1c60c0e10119b00a45c49","links":[],"anchors":{},"children":["vmcgt1bw13lwsobet50r3vl","pj0dbesw2qm5j1tub9f34pg","e40hlh2wukm75vo4t8r9c7p","7xwnx64er01irhu8wg1q5zm","4buyekecqhzdg87aqxmh1rz","n1xmefdyaaztqb8wmsmqtjj","d8p9jq81rc0pfbbuzz7prah","yq2839iijurmzkrwkqwo9ps","51sfhirev9l2r8bef9utfb9","xuw6kyksesfaatsmt3gctyi","njc2zpmxz8izls7ogwdj20h","d3ma1d2r59fhejrl6bn9g0e","tgd9pt1fu1j4ejm4g09vlx4","5jlkrg4hx6dpy5tr55grkh6","ockg1gb78gpshwty5zjmvue","owsm2ti22dslhpk9oduhhku","52x2zgp7jpygai1h0jpv0t8","2d5oqog2rsdfdogne54tq9t"],"parent":null,"data":{},"body":""},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true,"enableSelfContainedVaults":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":".","selfContained":true,"name":"Dendron"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"task","dateFormat":"y.MM.dd","addBehavior":"asOwnDomain","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"taskCompleteStatus":["done","x"],"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["dev","about"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Golbang Hacker","description":"Personal Knowledge Space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"search","assetsPrefix":"/pks-publish","siteUrl":"https://b2sdev.github.io","theme":"dark","siteFaviconPath":"favicon.ico","siteIndex":"dev"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"sfeu6c5r2tcv2mgr2xpo696"},"buildId":"MBpMZiPEoVJLwa6Uvfsj2","assetPrefix":"/pks-publish","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>